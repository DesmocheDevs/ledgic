generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Sexo {
  MASCULINO
  FEMENINO
  OTRO
}

model Client {
  id        String   @id @default(uuid())
  nombre    String
  apellido  String
  cedula    String   @unique
  numero    String?
  correo    String   @unique
  direccion String
  sexo      Sexo
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([cedula])
  @@index([correo])
  @@map("clients")
}

enum EstadoInventario {
  ACTIVO
  INACTIVO
  DESCONTINUADO
}

model Inventory {
  id           String           @id @default(uuid())
  nombre       String
  categoria    String
  estado       EstadoInventario
  unidadMedida String           @map("unidad_medida") @db.VarChar(50)
  proveedor    String?
  tipo         String?
  createdAt    DateTime         @default(now()) @map("creado")
  updatedAt    DateTime         @updatedAt @map("actualizado")
  materials    Material[]

  @@index([categoria])
  @@index([estado])
  @@map("inventory")
}

model Material {
  id           String            @id @default(uuid())
  precioCompra Decimal           @db.Decimal(10, 2)
  proveedor    String?
  inventarioId String            @map("inventario_id")
  inventario   Inventory         @relation(fields: [inventarioId], references: [id], onDelete: Cascade)
  createdAt    DateTime          @default(now()) @map("creado")
  updatedAt    DateTime          @updatedAt @map("actualizado")
  products     ProductMaterial[]

  @@index([inventarioId])
  @@map("materials")
}

model ProductMaterial {
  productId    String  @map("product_id")
  materialId   String  @map("material_id")
  cantidad     Decimal @db.Decimal(12, 4)
  unidadMedida String? @db.VarChar(50)

  product  Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  material Material @relation(fields: [materialId], references: [id], onDelete: Restrict)

  @@id([productId, materialId])
  @@map("product_materials")
}

model Product {
  id          String            @id @default(uuid())
  nombre      String
  descripcion String?
  precio      Decimal           @db.Decimal(10, 2)
  categoria   String?
  createdAt   DateTime          @default(now()) @map("creado")
  updatedAt   DateTime          @updatedAt @map("actualizado")
  materials   ProductMaterial[]

  @@index([categoria])
  @@map("products")
}
